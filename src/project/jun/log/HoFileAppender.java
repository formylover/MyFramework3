package project.jun.log;import java.io.IOException;import java.util.HashMap;import java.util.Hashtable;import java.util.Iterator;import java.util.Map;import org.apache.log4j.DailyRollingFileAppender;import org.apache.log4j.MDC;import org.apache.log4j.spi.LoggingEvent;public class HoFileAppender extends DailyRollingFileAppender{	private String mdcName;	private String pFileName;	private Map map = new HashMap();	public synchronized void doAppend(LoggingEvent event) {		Object key0 = MDC.get(getMdcName()); // MDC.get("userId");		if (key0 == null) {			super.doAppend(event);			return;		}		String key = key0.toString();		String file = "";		if (key != null && key.length() > 0 && !map.containsKey(key)) {			try {				file = "@" + key;				DailyRollingFileAppender dailyRollingFileAppender = new DailyRollingFileAppender(layout, pFileName.replaceAll("%"+getMdcName()+"%", file) , getDatePattern());				map.put(key, dailyRollingFileAppender);			} catch (IOException e) {			}		} 		DailyRollingFileAppender ap = (DailyRollingFileAppender) map.get(key);		if (ap != null) {			ap.doAppend(event);		} else {			super.append(event);		}	}		public void  setFile(String fileName) {		Object key0 = MDC.get(getMdcName()); // MDC.get("userId");		String key = "";		pFileName = fileName;		if (key0 != null) {			key = key0.toString();		}				fileName = fileName.replaceAll("%"+ (getMdcName()==null? "USER_ID" : getMdcName())+"%", key);		super.setFile(fileName);    }		public void close() {		for (Iterator iter = map.values().iterator(); iter.hasNext();) {			DailyRollingFileAppender appender = (DailyRollingFileAppender) iter.next();			appender.close();		}		super.close();	}	public void setMdcName(String mdcName) {		this.mdcName = mdcName;	}	public String getMdcName() {		return mdcName;	}}